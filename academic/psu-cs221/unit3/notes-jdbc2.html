<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd"><html><head><title>JDBC 2</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head><body><? // grab the headerinclude 'notes-header.php' ; ?><h1 align="center"><font color="#990033">More with JDBC and Database Wrap-Up </font></h1><p align="right"><font size="-1">Last Modified   <!-- #BeginDate format:Am2 -->4/25/12<!-- #EndDate --></font></p><p align="center">	<font size="1">		<a href="#resultset">More on ResultSets</a> &bull; 		<a href="#jtable1">JTable, Part I</a>  &bull; 		<a href="#jtable2">JTable, Part II</a> &bull; 		<a href="#transaction_index">More Database Issues</a> 	</font></p><hr><h2><font color="#990033"><a name="resultset" id="resultset"></a>More on ResultSets</font></h2><p>Last week, we looked at the <font face="Courier New, Courier, mono">ResultSet</font>, the fundamental object returned to Java when we execute a query. </p><p>First, it's worth reviewing the <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/sql/ResultSet.html"><font face="Courier New, Courier, mono">ResultSet</font> API entry</a> for more accessors and modifiers which let you move the cursor around, should you want to. </p><p>Of particular interest is a class called <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/sql/ResultSetMetaData.html"><font face="Courier New, Courier, mono">ResultSetMetaData</font></a>, which gives us information about the result set. We can use a ResultSet accessor as follows to get the meta data: </p><blockquote>  <pre>ResultSet results = stmt.executeQuery(testQuery);ResultSetMetaData metaData = results.getMetaData(); </pre></blockquote><p>Here are some of the accessors we can call on the <font face="Courier New, Courier, mono">ResultSetMetaData</font> object:</p><ul>  <li><font face="Courier New, Courier, mono">getColumnCount()</font></li>  <li><font face="Courier New, Courier, mono">getColumnClassName(<em>i</em>) </font>- tells us the corresponding Java class for column <em>i</em> of the result set </li></ul><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#resultset">More on ResultSets</a> &bull; <a href="#jtable1">JTable, Part I</a> &bull; <a href="#jtable2">JTable, Part II</a>  &bull; <a href="#transaction_index">More Database Issues</a> </font> </p><hr><h2><font color="#990033"><a name="jtable1" id="jtable1"></a>JTable, Part I </font> </h2><p>A final GUI component worth mentioning is the table, implemented as <font face="Courier New, Courier, mono">JTable</font>. Tables are a natural way of displaying database results. We might modify the last lab with a GUI that looks something like this:</p><blockquote>  <p><img src="jtable-db-ex.png" alt="Dialog with title 'Database GUI' and a 'View Records' button directly beneath it and occupying the complete horizontal space of the dialog. Below this is a table with rows with these titles: Course ID, Dept., Num, Name, # Credits. The table is populated with data that is used in class examples. For the SQL code to insert all of these records into the 'courses' table, go to http://php.scripts.psu.edu/djh300/cmpsc221/course_inserts.sql." width="615" height="496"> </p></blockquote><p>We could implement very simple tables or very complicated tables. We'll look at a simple example below. Tables have behind them a table model, of which a default is provided. I encourage you to read through <a href="http://java.sun.com/docs/books/tutorial/uiswing/components/table.html">Sun's tutorial on JTables</a> for all of the details. Some of you may find you want to go with tables for a feature in your final project and will find this tutorial helpful. </p><p>&nbsp; </p><p>&nbsp;</p><p align="center"><font size="1"><a href="#resultset">More on ResultSets</a> &bull; <a href="#jtable1">JTable, Part I</a> &bull; <a href="#jtable2">JTable, Part II</a>  &bull; <a href="#transaction_index">More Database Issues</a> </font></p><hr><h2><font color="#990033"><a name="jtable2" id="jtable2"></a>JTable, Part II </font></h2><p>Here we'll look at the code for creating a basic <font face="Courier New, Courier, mono">JTable</font> to display some query results. I've built this code in an application that extends <font face="Courier New, Courier, mono">JFrame</font>. Its constructor doesn't do anything regarding the table; rather I'm placing all of this code for creating and displaying the table in an event handler. </p><p>First off, we need the following import statement for a table: </p><blockquote>  <pre>import javax.swing.JTable;</pre></blockquote><p>We'll first need variables to execute the query:</p><blockquote>  <pre>String testQuery;<br>Statement stmt;<br>ResultSet results;</pre></blockquote><p>To create the table, we'll need two arrays. First, we need an array of the column headers (which I've treated like a typical constant):</p><blockquote>  <pre> private static final String[] COLS =   {&quot;Course ID&quot;, &quot;Dept.&quot;, &quot;Num&quot;, &quot;Name&quot;, &quot;# Credits&quot;}; </pre></blockquote><p>The second array is a two-dimensional array of the data that will go in the table. We can't send a null array in, so we'll construct it as follows:</p><blockquote>  <pre> Object[][] data = new Object[MAX_ROWS][MAX_COLS];</pre></blockquote><p>Now we'll construct the empty table from these arrays, and add it to the GUI. Notice a few things:</p><ul>  <li>We'll likely want a scrollbar, which we add like we did for text areas.</li>  <li>The column headers are added to the GUI separately from the data rows. For this reason, I've opted to put the whole table in its own panel.</li>  <li>When we change the GUI, we need to call <font face="Courier New, Courier, mono">validate()</font>. </li></ul><p>Here's the code, with table-specific code in color: </p><blockquote>  <pre>JPanel tablePanel = new JPanel(new BorderLayout());<font color="#000066"><strong>JTable table = new JTable(data, COLS);</strong></font>add(new JScrollPane(table));tablePanel.add(<strong><font color="#000066">table.getTableHeader()</font></strong>, BorderLayout.NORTH);tablePanel.add(table, BorderLayout.CENTER);add(tablePanel, BorderLayout.CENTER);validate();</pre></blockquote><p>Next we execute the query and get our result set object as before:</p><blockquote>  <pre>testQuery = &quot;select * from courses&quot;;<br>stmt = myConnection.createStatement();<br>results = stmt.executeQuery(testQuery);</pre></blockquote><p>Now we can use the <font face="Courier New, Courier, mono">setValueAt</font> modifier on the table to change it. Its general form is:</p><blockquote>  <pre>tableObject<strong><font color="#000066">.setValueAt(</font></strong>newValue<font color="#000066"><strong>,</strong></font> rowIndex<font color="#000066"><strong>,</strong></font> columnIndex<strong><font color="#000066">); </font></strong></pre></blockquote><p>So, we might do something like this: </p><blockquote>  <pre>while(results.next())                   <br>{           <br>   table.setValueAt(results.getInt(&quot;course_id&quot;), row, 0);<br>   table.setValueAt(results.getString(&quot;dept&quot;), row, 1);<br>   table.setValueAt(results.getInt(&quot;number&quot;), row, 2);<br>   table.setValueAt(results.getString(&quot;name&quot;), row, 3);<br>   table.setValueAt(results.getInt(&quot;credits&quot;), row, 4);<br>           <br>   row++;<br>}</pre></blockquote><p>Finally, we'd do some cleanup:</p><blockquote>  <pre>results.close();                        <br>stmt.close(); </pre></blockquote><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#resultset">More on ResultSets</a> &bull; <a href="#jtable1">JTable, Part I</a> &bull; <a href="#jtable2">JTable, Part II</a>  &bull; <a href="#transaction_index">More Database Issues</a> </font></p><hr><h2><font color="#990033"><a name="transaction_index" id="transaction_index"></a>Other Database Issues </font> </h2><p>If you're interested in learning more about databases, consider taking CMPSC 431W. (CMPSC majors: This is one of the two options you have to fulfill your writing-intensive course requirement.) </p><p>This section gives a high-level overview of two advanced concepts.</p><h3><font color="#990033">Transactions</font></h3><p>In practice, SQL statements that make changes to the database are grouped into <strong>transactions</strong>. If a transaction changes the database in desired ways, then one can <strong>commit </strong>the transaction to make the changes permanent. But if the transaction proves erroneous, it's possible to <strong>rollback</strong> the transaction, restoring the database to its state before the transaction. </p><h3><font color="#990033">Indexes</font></h3><p>Whenever we insert data into the database, there's no defined order to the information and searching is analogous to a linear search. As we get large  tables, performance degrades. We can address this problem by creating <strong>indexes</strong> to the database, which help the DBMS execute queries faster. The index helps the DBMS search for records without looking at all the records, if it's deemed that using the index will speed up searches. </p><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#resultset">More on ResultSets</a> &bull; <a href="#jtable1">JTable, Part I</a> &bull; <a href="#jtable2">JTable, Part II</a> &bull; <a href="#transaction_index">More Database Issues</a> </font></p></body></html>