<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd"><html><head><title>JDBC</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head><body><? // grab the headerinclude 'notes-header.php' ; ?><h1 align="center"><font color="#990033">Java DataBase Connectivity (JDBC) </font></h1><p align="right"><font size="-1">Last Modified   <!-- #BeginDate format:Am2 -->11/29/11<!-- #EndDate --></font></p><p align="center">	<font size="1">		<a href="#idea">The Idea</a> &bull; 		<a href="#env">Setting Up the Environment</a>  &bull; 		<a href="#code">Java Code</a> &bull; 		<a href="#other">Other Notes</a> 	</font></p><hr><h2><font color="#990033"><a name="idea"></a>The Idea </font></h2><p>We know how to build and query a database using SQL, which is a powerful framework in and of itself. We can put the power of a SQL back-end in a Java program via <strong>Java DataBase Connectivity (JDBC)</strong>. Here are just a few benefits: </p><ul>  <li> Use Java's GUI to create a user-friendly front-end.</li>  <li>Use Java's platform independence to create web-friendly database applications.</li>  <li>Use Java's capabilities as a programming language to parse files of data and populate a database. </li></ul><p>In order to use JDBC, we have the following general steps:</p><ol>  <li>Create the database and enable it to accept connections.</li>  <li>Set up the Java environment/project workspace to connect to a database. </li>  <li>Create an instance of the database client driver in the Java code. </li>  <li>Create a connection to the database in the Java code. (A <font face="Courier New, Courier, mono">Connection</font> object.)</li>  <li>Write SQL statement(s) to insert records into the database or retrieve records from the database  via JBDC/Java. (A <font face="Courier New, Courier, mono">Statement</font> object.)</li>  <li>Execute the SQL statement and retrieve the results. (A <font face="Courier New, Courier, mono">ResultSet</font> object.)</li>  <li>Process the results, e.g. iterate through the <font face="Courier New, Courier, mono">ResultSet</font> object. </li>  <li>Close the <font face="Courier New, Courier, mono">ResultSet</font>, <font face="Courier New, Courier, mono">Statement</font>, and <font face="Courier New, Courier, mono">Connection</font> objects when we're finished with them. </li></ol><p>Note that, like working with data files where we only need to open and close files once to do several operations, once we've set up the database connection (Steps 1-4 above), we can execute as many SQL statements as we like <em>without</em> reopening the connection. </p><p>In these notes, we'll work with specifics for working with Apache Derby. Note that the general idea outlined above applies to other databases, but the specifics of setting up the environment can change and present challenges. </p><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#idea">The Idea</a> &bull; <a href="#env">Setting Up the Environment</a> &bull; <a href="#code">Java Code</a> &bull; <a href="#other">Other Notes</a> </font> </p><hr><h2><font color="#990033"><a name="env"></a>Environment Setup </font> </h2><h3><font color="#990000">Database</font></h3><p>We need to create the database using Apache Derby. The details of this are covered in a previous lecture. </p><p>We also need to set up the database to accept connections. In Netbeans, do the following:</p><ol>  <li>Go to the <strong>Services</strong> tab.</li>  <li>Right-click the database to which you wish to connect and choose <strong>Connect</strong>. </li></ol><p>You should see an output message telling you the database is now ready to accept connections.</p><p>&nbsp; </p><h3><font color="#990000">Project</font></h3><p>We need to tell the project we'll be working with Derby in two ways. </p><p>First, we need to go through the following steps to tell the project we intend to use Derby:</p><ol>  <li>Go to the <strong>Projects</strong> tab.</li>  <li>Right-click the project you want and choose <strong>Properties</strong>.</li>  <li>Go to the <strong>Libraries</strong> tab in the left side of this dialog.</li>  <li>Choose the <strong>Run</strong> tab on the right side of this dialog. </li>  <li>Click the <strong>Add JAR/Folder </strong>button. </li>  <li>Locate <strong>derby.jar</strong> and click <strong>Choose</strong>.    <ul>      <li>On Mac OS X, this may be found at <font face="Courier New, Courier, mono">/Applications/NetBeans/glassfish-v3-prelude/javadb/lib/derby.jar</font>.</li>      <li>On Windows in the default Netbeans installation, this may be found at <font face="Courier New, Courier, mono">C:\Program Files\Sun\JavaDB\lib\derby.jar</font>. </li>      <li>Other possible locations on Windows where the NetBeans installer may have put this driver are:        <ul>          <li><font face="Courier New, Courier, mono">C:\Sun\AppServer\javadb\lib\derby.jar</font></li>          <li><font face="Courier New, Courier, mono">C:\Program Files\glassfish-3.1.1\javadb\lib</font></li>        </ul>      </li>    </ul>  </li></ol><p>Then, we need to set up the client for Derby by creating a library for it and adding it to the project:</p><ol>  <li>Go to <strong>Tools &gt; Libraries</strong>. </li>  <li>Select <strong>New Library... </strong>in the lower left of this dialog. </li>  <li>Enter a <strong>Library Name </strong>of <font face="Courier New, Courier, mono">JavaDB-Network</font>, then choose <strong>Add JAR/Folder</strong> and browse to find <font face="Courier New, Courier, mono">derbyclient.jar</font>. (Look to the same directory location as above.)</li>  <li>Then go back to the <strong>Projects</strong> tab.</li>  <li>Right-click the project you want and choose <strong>Properties</strong>.</li>  <li>Go to the <strong>Libraries</strong> tab in the left side of this dialog.</li>  <li>Choose the <strong>Compile</strong> tab on the right side of this dialog this time. </li>  <li>Click the <strong>Add Library </strong>button</li>  <li>Locate the <font face="Courier New, Courier, mono">JavaDB-Network</font> library you just created.</li>  <li>Click <strong>OK</strong>. </li></ol><p>(If you're running version 7.0.1 of NetBeans, you may need to click an <strong>Import...</strong> button between Steps 7 and 8.)</p><p>You should then be able to proceed with pure Java source code to compile an run your JDBC project. </p><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#idea">The Idea</a> &bull; <a href="#env">Setting Up the Environment</a> &bull; <a href="#code">Java Code</a> &bull; <a href="#other">Other Notes</a> </font></p><hr><h2><font color="#990033"><a name="code"></a>The Code </font></h2><p>First, we need an import statement in order to allow Java and SQL to talk:</p><blockquote>  <pre><font color="#000066">import java.sql.*;</font>  </pre></blockquote><p>&nbsp;</p><h3><font color="#990000">Establishing the Database Connection</font></h3><p>Now, we'll look at code for establishing the database connection. Use common sense in choosing where to put database connection code. If you access the database only within one method of a class, you want to make the database connections within that method. If you access the database within multiple methods, the database connection code would be more appropriately placed class-wide (i.e. using a class member variable and likely opened within constructors). </p><p>This line of code creates an instance of the driver for the database:</p><blockquote>  <pre><font color="#000066">Class.forName(&quot;org.apache.derby.jdbc.ClientDriver&quot;).newInstance();</font> </pre></blockquote><p>You then need to connect to the database. Here's the general form of a line of code for doing so:</p><blockquote>  <pre><font color="#000066">Connection myConnection =    DriverManager.getConnection( </font><em>database URL</em><font color="#000066"><em> </em>,<em> </em></font><em>username</em><font color="#000066"><em> </em>, </font><em>password</em><font color="#000066"><em> </em>); </font></pre></blockquote><p>Obtain the database URL from the <strong>Services</strong> tab in Netbeans. For example, you might connect using the following arguments: </p><blockquote>  <pre><font color="#000066">Connection myConnection =    DriverManager.getConnection(&quot;jdbc:derby://localhost:1527/sample&quot;, &quot;app&quot;, &quot;app&quot;)</font></pre></blockquote><p>&nbsp;</p><h3><font color="#990000">Communicating with the Database</font></h3><p>We communicate with the database via SQL. For basic access, we have two types of objects we use. </p><p>We must begin by creating a <font face="Courier New, Courier, mono">Statement</font> object, e.g. </p><blockquote>  <pre><font color="#000066">Statement stmt = myConnection.createStatement();</font></pre></blockquote><p>We can use this <font face="Courier New, Courier, mono">Statement</font> object to query the database. It is the <font face="Courier New, Courier, mono">executeQuery()</font> and <font face="Courier New, Courier, mono">execute()</font> method of the <font face="Courier New, Courier, mono">Statement</font> class that do the work; they take SQL statements as an argument. </p><p>Here's how they break down:</p><ul>  <li><font face="Courier New, Courier, mono">executeQuery()</font>:    <ul>      <li>Used for <font face="Courier New, Courier, mono">select</font> statements that return results. </li>      <li>We get results back that we'll want to process. In this case, calls to <font face="Courier New, Courier, mono">executeQuery()</font> will return a <font face="Courier New, Courier, mono">ResultSet</font> object, so we should create one and store the output in it. </li>    </ul>  </li>  <li><font face="Courier New, Courier, mono">execute()</font>:    <ul>      <li>Used for  other statements like <font face="Courier New, Courier, mono">insert</font>, <font face="Courier New, Courier, mono">update</font>, or <font face="Courier New, Courier, mono">delete</font> that don't return anything.</li>      <li>No results come back; just call the method like any other <font face="Courier New, Courier, mono">void</font>. </li>    </ul>  </li></ul><p>I find it best to create SQL queries first in String objects and then pass those String objects to <font face="Courier New, Courier, mono">executeQuery()</font> or <font face="Courier New, Courier, mono">execute()</font>. </p><p>Combining all of these ideas, here's an example of how the code might look to execute a simple &quot;select&quot; statement:</p><blockquote>  <pre>String testQuery;<br>Statement stmt;<br>ResultSet results; <br>testQuery = &quot;select * from buildings&quot;;<br>stmt = myConnection.createStatement();results = stmt.executeQuery(testQuery);</pre></blockquote><h3>&nbsp;</h3><h3><font color="#990000">Processing Results</font></h3><p>The <font face="Courier New, Courier, mono">ResultSet</font> object can be processed via an iterator. This is much like working with a file pointer in C++. We don't know how many rows will be returned by the &quot;select&quot; statement, so we need to use an indeterminate loop. As both the loop test and update step of this loop, we'll use the <font face="Courier New, Courier, mono">next()</font> method of <font face="Courier New, Courier, mono">ResultSet</font> to move the iterator along. Then, within the loop, we can call upon methods that retrieve fields of the current result record. These methods depend on the data type of the field, e.g. <font face="Courier New, Courier, mono">getString</font>, <font face="Courier New, Courier, mono">getDouble</font>, <font face="Courier New, Courier, mono">getInt</font>, <font face="Courier New, Courier, mono">getDate</font>. Each takes a string argument that is the name of the field we want to retrieve. </p><p>Here's an example loop to print out an integer from a field called &quot;building_id&quot; and a string from a field called &quot;name&quot; for all result records:</p><blockquote>  <pre>while(results.next())          // iterate through results<br>{<br>   System.out.println(&quot;Result: &quot; + results.getInt(&quot;building_id&quot;) <br>                                 + &quot;: &quot; + results.getString(&quot;name&quot;));}</pre>  <pre>&nbsp;</pre></blockquote><h3><font color="#990000">Closing Objects</font></h3><p>Each of the <font face="Courier New, Courier, mono">ResultSet</font>, <font face="Courier New, Courier, mono">Statement</font>, and <font face="Courier New, Courier, mono">Connection</font> objects has a close() method we should call when we're done with it, e.g. </p><blockquote>  <pre>results.close();stmt.close();myConnection.close();</pre></blockquote><p>&nbsp;</p><h3><font color="#990000">Exception Handling </font></h3><p>Because of problems that could occur, we should put all database access code within a <font face="Courier New, Courier, mono">try...catch</font> block. Two specific exceptions to catch are:</p><ul>  <li>The <font face="Courier New, Courier, mono">ClassNotFoundException</font>, which would be thrown if there's a problem creating an instance of the database driver.</li>  <li>The <font face="Courier New, Courier, mono">SQLException</font>, which would be thrown if there's any problem connecting to the database or communicating data to/from it. </li></ul><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#idea">The Idea</a> &bull; <a href="#env">Setting Up the Environment</a> &bull; <a href="#code">Java Code</a> &bull; <a href="#other">Other Notes</a> </font></p><hr><h2><font color="#990033"><a name="other"></a>Other Notes </font></h2><p>These notes present the basic ideas of JDBC. Of course, we can combine these ideas with the other ideas in our toolkit for better programs. It is a good starting point to create a command-line program for displaying database results, and indeed this may be fine for many data processing applications. However, it may be best to use what we know about GUIs to communicate with the user in a more friendly fashion. We'll add a little more on this in the next class. </p><p>Chapter 28 of Deitel &amp; Deitel provides some more information on JDBC, although much of this information is general, whereas I has focused on Derby here. </p><p>See Section 28.11 for information on a powerful alterative to the <font face="Courier New, Courier, mono">Statement</font> class called a <font face="Courier New, Courier, mono">PreparedStatement</font>. </p><p><strong>A tip: </strong>Writing Java code to generate SQL code can be syntactically tricky. String concatenation works fine. But using <font face="Courier New, Courier, mono">String.format</font> instead will save you some frustration. Remember that <font face="Courier New, Courier, mono">%s</font> is the placeholder for a string. </p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p align="center"><font size="1"><a href="#idea">The Idea</a> &bull; <a href="#env">Setting Up the Environment</a> &bull; <a href="#code">Java Code</a> &bull; <a href="#other">Other Notes</a> </font></p></body></html>